<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gestión de Usuarios — Super Admin | Clínica Sonrisa Feliz</title>

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <style>
    /* ----------------- Reset & Base ----------------- */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:#f5f9ff;
      color:#203139;
      display:flex;
      min-height:100vh;
    }

    /* ----------------- Sidebar ----------------- */
    .sidebar{
      width:260px;
      background:linear-gradient(180deg,#00bfa6,#009688);
      color:#fff;
      padding:22px 18px;
      box-shadow:2px 0 12px rgba(0,0,0,0.06);
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .sidebar .brand{
      display:flex;align-items:center;gap:12px;padding-bottom:6px;border-bottom:1px solid rgba(255,255,255,0.08);
    }
    .sidebar .brand img{width:44px;height:44px;border-radius:8px;object-fit:cover}
    .sidebar nav{margin-top:8px;display:flex;flex-direction:column;gap:6px}
    .sidebar a{
      color:rgba(255,255,255,0.95);text-decoration:none;padding:10px 12px;border-radius:8px;display:flex;align-items:center;gap:10px;font-weight:500;
      transition:all .18s ease;
    }
    .sidebar a i{font-size:1.1rem}
    .sidebar a.active, .sidebar a:hover{background:rgba(255,255,255,0.12);transform:translateX(4px)}

    /* ----------------- Main area ----------------- */
    .main{
      flex:1;
      display:flex;
      flex-direction:column;
      min-height:100vh;
    }

    .header{
      background:rgba(255,255,255,0.9);
      backdrop-filter:blur(6px);
      border-bottom:1px solid #e6eef0;
      padding:18px 28px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .header .title{font-size:1.15rem;color:#00796b;font-weight:600}
    .header .userbox{display:flex;align-items:center;gap:12px;color:#4b6363}
    .header .userbox img{width:40px;height:40px;border-radius:50%;object-fit:cover;box-shadow:0 2px 6px rgba(0,0,0,0.08)}

    .container{
      padding:22px 28px;
      flex:1;
      overflow:auto;
    }

    /* ----------------- Page header / actions ----------------- */
    .page-head{
      display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:18px;
      flex-wrap:wrap;
    }
    .page-head h2{margin:0;color:#0b6b63;font-size:1.25rem}
    .actions{
      display:flex;gap:10px;align-items:center;
    }
    .search{
      display:flex;align-items:center;background:#fff;padding:8px 10px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.03);
      gap:8px;border:1px solid #e7f2f1;
    }
    .search input{border:none;outline:none;font-size:0.95rem;width:220px}
    .btn{
      background:#009688;color:#fff;border:none;padding:9px 14px;border-radius:10px;font-weight:600;cursor:pointer;
      box-shadow:0 6px 18px rgba(0,150,136,0.12);transition:all .18s ease;
    }
    .btn.secondary{background:#e8f6f3;color:#00796b;border:1px solid #cfeee9}
    .btn.icon{display:inline-flex;align-items:center;gap:8px}

    /* ----------------- Cards / stats ----------------- */
    .card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;margin-bottom:18px}
    .stat-card{
      background:#fff;padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(32,178,170,0.06);border:1px solid rgba(0,0,0,0.03);
      display:flex;flex-direction:column;gap:8px;align-items:flex-start;
    }
    .stat-card .num{font-size:1.3rem;font-weight:700;color:#00796b}
    .stat-card .label{font-size:0.9rem;color:#5b7776}

    /* ----------------- Table ----------------- */
    .panel{
      background:transparent;border-radius:12px;padding:10px 0;
    }
    table{
      width:100%;border-collapse:collapse;background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,0.04)
    }
    thead th{background:linear-gradient(90deg,#00bfa6,#009688);color:#fff;padding:12px 14px;text-align:left;font-weight:600}
    tbody td{padding:12px 14px;border-bottom:1px solid #f1f6f5}
    tbody tr:last-child td{border-bottom:none}
    .avatar{width:38px;height:38px;border-radius:8px;object-fit:cover;margin-right:10px}
    .role-badge{padding:6px 10px;border-radius:999px;font-weight:600;font-size:0.85rem}
    .role-super{background:#ffe9e6;color:#b02a2a}
    .role-admin{background:#fff2e6;color:#b36b00}
    .role-recep{background:#e8f6f3;color:#00796b}
    .role-doc{background:#e8f0ff;color:#0b57b7}

    .actions-td button{background:transparent;border:0;color:#2b7a73;cursor:pointer;margin-right:8px;font-size:1rem}
    .actions-td button.delete{color:#c0392b}

    /* ----------------- Pagination ----------------- */
    .pager{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:12px}
    .pager button{background:#fff;border:1px solid #e6f2f0;padding:8px 10px;border-radius:8px;cursor:pointer}
    .pager button.active{background:#009688;color:#fff;border-color:#009688}

    /* ----------------- Modal ----------------- */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,8,8,0.45);display:none;align-items:center;justify-content:center;z-index:999}
    .modal{
      background:#fff;width:720px;max-width:94%;border-radius:12px;padding:18px;box-shadow:0 12px 40px rgba(2,8,8,0.5);
      transform:translateY(-10px);opacity:0;transition:all .18s ease;
    }
    .modal.show{transform:none;opacity:1}
    .modal header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .modal header h3{margin:0;color:#00796b}
    .form-row{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:10px}
    .form-row.single{grid-template-columns:1fr}
    .form-row input, .form-row select{padding:10px;border-radius:8px;border:1px solid #e6f2f0}
    .form-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:6px}

    /* ----------------- Responsive ----------------- */
    @media (max-width:900px){
      .sidebar{display:none}
      body{flex-direction:column}
      .header{position:sticky;top:0;z-index:20}
    }
  </style>
</head>
<body>

  
  

  <!-- MAIN -->
  <main class="main" role="main">
    <div class="header" role="region" aria-label="Encabezado">
      <div class="title">Gestión de Usuarios</div>
      <div class="userbox">
        <img src="https://i.pravatar.cc/100?img=12" alt="Admin">
        <div>
          <div style="font-weight:600">Admin Principal</div>
          <div style="font-size:.85rem;color:#557676">superadmin@clinica.com</div>
        </div>
      </div>
    </div>

    <section class="container" aria-live="polite">
      <!-- page head -->
      <div class="page-head">
        <h2>Usuarios del sistema</h2>
        <div class="actions">
          <div class="search" title="Buscar usuarios">
            <i class="bi bi-search"></i>
            <input id="searchInput" placeholder="Buscar por nombre, email o rol...">
          </div>
          <button class="btn secondary icon" id="importBtn"><i class="bi bi-file-earmark-arrow-up"></i> Importar</button>
          <button class="btn icon" id="addUserBtn"><i class="bi bi-person-plus"></i> Nuevo Usuario</button>
        </div>
      </div>

      <!-- stats -->
      <div class="card-grid" aria-hidden="false">
        <div class="stat-card">
          <div class="num" id="totalUsers">125</div>
          <div class="label">Usuarios Totales</div>
        </div>
        <div class="stat-card">
          <div class="num" id="activeUsers">98</div>
          <div class="label">Usuarios Activos</div>
        </div>
        <div class="stat-card">
          <div class="num" id="rolesCount">5</div>
          <div class="label">Roles definidos</div>
        </div>
        <div class="stat-card">
          <div class="num" id="lastBackup">02/11/2025</div>
          <div class="label">Última copia</div>
        </div>
      </div>

      <!-- panel table -->
      <div class="panel" role="region" aria-label="Listado de usuarios">
        <table id="usersTable" aria-describedby="usersHeading">
          <thead>
            <tr>
              <th>Usuario</th>
              <th>Email</th>
              <th>Rol</th>
              <th>Estado</th>
              <th style="width:140px;text-align:right">Acciones</th>
            </tr>
          </thead>
          <tbody id="usersTbody">
            <!-- filas inyectadas por JS -->
          </tbody>
        </table>

        <div class="pager" id="pager"></div>
      </div>
    </section>
  </main>

  <!-- MODAL: add / edit -->
  <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <header>
        <h3 id="modalTitle">Nuevo Usuario</h3>
        <button id="closeModal" aria-label="Cerrar" style="background:transparent;border:0;font-size:1.25rem;color:#777;cursor:pointer">✕</button>
      </header>

      <form id="userForm">
        <div class="form-row">
          <input type="text" id="firstName" placeholder="Nombre completo" required>
          <input type="email" id="email" placeholder="Correo electrónico" required>
        </div>

        <div class="form-row">
          <select id="role">
            <option value="super_admin">Super Admin</option>
            <option value="admin">Administrador General</option>
            <option value="recepcionista">Recepcionista</option>
            <option value="odontologo">Odontólogo</option>
            <option value="paciente">Paciente</option>
          </select>

          <select id="status">
            <option value="activo">Activo</option>
            <option value="suspendido">Suspendido</option>
          </select>
        </div>

        <div class="form-row single">
          <input type="text" id="notes" placeholder="Notas / Observaciones (opcional)">
        </div>

        <div class="form-actions">
          <button type="button" class="btn secondary" id="cancelBtn">Cancelar</button>
          <button type="submit" class="btn" id="saveBtn">Guardar usuario</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    /* ----------------- Mock data inicial ----------------- */
    const usersData = [
      {id:1,name:'María Pérez',email:'maria@clinica.com',role:'admin',status:'activo',avatar:'https://i.pravatar.cc/80?img=5'},
      {id:2,name:'Carlos Torres',email:'carlos@clinica.com',role:'super_admin',status:'activo',avatar:'https://i.pravatar.cc/80?img=6'},
      {id:3,name:'Ana López',email:'ana@clinica.com',role:'recepcionista',status:'activo',avatar:'https://i.pravatar.cc/80?img=7'},
      {id:4,name:'Dr. Julio Quiroga',email:'julio@clinica.com',role:'odontologo',status:'activo',avatar:'https://i.pravatar.cc/80?img=8'},
      {id:5,name:'Paciente Demo',email:'paciente@correo.com',role:'paciente',status:'suspendido',avatar:'https://i.pravatar.cc/80?img=9'},
      // ... puedes añadir más para probar paginación
    ];

    /* ----------------- Estado UI ----------------- */
    let currentPage = 1;
    const pageSize = 6;
    let filtered = [...usersData];
    let editingId = null;

    /* ----------------- Utilidades ----------------- */
    function roleLabel(role){
      switch(role){
        case 'super_admin': return '<span class="role-badge role-super">Super Admin</span>';
        case 'admin': return '<span class="role-badge role-admin">Admin Gen.</span>';
        case 'recepcionista': return '<span class="role-badge role-recep">Recepción</span>';
        case 'odontologo': return '<span class="role-badge role-doc">Odontólogo</span>';
        default: return '<span class="role-badge">Paciente</span>';
      }
    }

    function renderTable(){
      const tbody = document.getElementById('usersTbody');
      tbody.innerHTML = '';
      const start = (currentPage-1)*pageSize;
      const pageItems = filtered.slice(start, start+pageSize);

      pageItems.forEach(u=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td style="display:flex;align-items:center">
            <img src="${u.avatar}" class="avatar" alt="">
            <div>
              <div style="font-weight:600">${u.name}</div>
              <div style="font-size:.85rem;color:#5b7776">${u.email}</div>
            </div>
          </td>
          <td>${u.email}</td>
          <td>${roleLabel(u.role)}</td>
          <td style="font-weight:600;color:${u.status==='activo'?'#00796b':'#c0392b'}">${u.status}</td>
          <td class="actions-td" style="text-align:right">
            <button title="Editar" onclick="openEdit(${u.id})"><i class="bi bi-pencil-square"></i></button>
            <button title="Resetear contraseña" onclick="resetPassword(${u.id})"><i class="bi bi-key"></i></button>
            <button title="Eliminar" class="delete" onclick="deleteUser(${u.id})"><i class="bi bi-trash"></i></button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      renderPager();
      updateStats();
    }

    function renderPager(){
      const total = filtered.length;
      const pages = Math.max(1, Math.ceil(total / pageSize));
      const pager = document.getElementById('pager');
      pager.innerHTML = '';
      for(let i=1;i<=pages;i++){
        const btn = document.createElement('button');
        btn.textContent = i;
        if(i===currentPage) btn.classList.add('active');
        btn.onclick = ()=>{ currentPage=i; renderTable(); }
        pager.appendChild(btn);
      }
    }

    function updateStats(){
      document.getElementById('totalUsers').textContent = usersData.length;
      document.getElementById('activeUsers').textContent = usersData.filter(u=>u.status==='activo').length;
      const roles = new Set(usersData.map(u=>u.role));
      document.getElementById('rolesCount').textContent = roles.size;
    }

    /* ----------------- Search ----------------- */
    document.getElementById('searchInput').addEventListener('input', e=>{
      const q = e.target.value.trim().toLowerCase();
      filtered = usersData.filter(u =>
        u.name.toLowerCase().includes(q) ||
        u.email.toLowerCase().includes(q) ||
        u.role.toLowerCase().includes(q)
      );
      currentPage = 1;
      renderTable();
    });

    /* ----------------- Modal controls ----------------- */
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modal = modalBackdrop.querySelector('.modal');

    document.getElementById('addUserBtn').addEventListener('click', ()=>{
      openNew();
    });

    document.getElementById('closeModal').addEventListener('click', closeModal);
    document.getElementById('cancelBtn').addEventListener('click', closeModal);
    modalBackdrop.addEventListener('click', (e)=>{
      if(e.target===modalBackdrop) closeModal();
    });

    function openNew(){
      editingId = null;
      document.getElementById('modalTitle').textContent = 'Nuevo Usuario';
      document.getElementById('userForm').reset();
      showModal();
    }

    function openEdit(id){
      const u = usersData.find(x=>x.id===id);
      if(!u) return;
      editingId = id;
      document.getElementById('modalTitle').textContent = 'Editar Usuario';
      document.getElementById('firstName').value = u.name;
      document.getElementById('email').value = u.email;
      document.getElementById('role').value = u.role;
      document.getElementById('status').value = u.status;
      document.getElementById('notes').value = u.notes || '';
      showModal();
    }

    function showModal(){
      modalBackdrop.style.display = 'flex';
      setTimeout(()=> modal.classList.add('show'), 10);
      modalBackdrop.setAttribute('aria-hidden','false');
    }
    function closeModal(){
      modal.classList.remove('show');
      setTimeout(()=> {
        modalBackdrop.style.display = 'none';
        modalBackdrop.setAttribute('aria-hidden','true');
      },160);
    }

    /* ----------------- Form submit: save user (mock) ----------------- */
    document.getElementById('userForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const name = document.getElementById('firstName').value.trim();
      const email = document.getElementById('email').value.trim();
      const role = document.getElementById('role').value;
      const status = document.getElementById('status').value;
      const notes = document.getElementById('notes').value.trim();

      if(editingId){
        // editar
        const idx = usersData.findIndex(x=>x.id===editingId);
        if(idx>-1){
          usersData[idx].name = name;
          usersData[idx].email = email;
          usersData[idx].role = role;
          usersData[idx].status = status;
          usersData[idx].notes = notes;
        }
      } else {
        // nuevo
        const newId = Math.max(0,...usersData.map(u=>u.id))+1;
        usersData.unshift({
          id:newId,
          name,
          email,
          role,
          status,
          avatar:`https://i.pravatar.cc/80?img=${Math.floor(Math.random()*70)+10}`,
          notes
        });
      }

      filtered = [...usersData];
      currentPage = 1;
      renderTable();
      closeModal();
    });

    /* ----------------- Actions: delete / reset ----------------- */
    function deleteUser(id){
      if(!confirm('¿Eliminar este usuario? Esta acción no se puede deshacer en el prototipo.')) return;
      const idx = usersData.findIndex(x=>x.id===id);
      if(idx>-1) usersData.splice(idx,1);
      filtered = [...usersData];
      renderTable();
    }

    function resetPassword(id){
      alert('Solicitud de reset de contraseña enviada (prototipo). ID usuario: '+id);
    }

    /* ----------------- Import (mock) ----------------- */
    document.getElementById('importBtn').addEventListener('click', ()=>{
      alert('Función de importación (CSV/Excel) — pendiente para backend.');
    });

    /* ----------------- Inicial render ----------------- */
    (function init(){
      filtered = [...usersData];
      renderTable();
    })();
  </script>
</body>
</html>
